---
include:
  - ../components/caddy_network.yaml

#networks:

volumes:
  calibreweb-config:
    external: true
  calibreserver-config:
    external: true
  media_books:
    driver: local
    driver_opts:
      type: nfs
      o: ${NFS_O}
      device: ":${NFS_DEVICE_MEDIA}/books"


#secrets:

services:
  calibreweb:
    image: lscr.io/linuxserver/calibre-web:latest@sha256:20e584b010124c27667b8d5cbbfb74e9e673c6f43124b53c0fe2d9459ce3f4ed
    pull_policy: ${pull_policy}
    container_name: ${calibreweb_container_name}
    restart: ${restart}
    networks:
      caddy:
        ipv4_address: 30.30.30.45
    ports:
      - ${calibreweb_port_8083}:8083
    environment:
      - TZ=${timezone}
      - PUID=1000
      - PGID=1000 
    volumes:
      - calibreweb-config:/config
      - media_books:/books

  calibreserver:
    image: lscr.io/linuxserver/calibre:latest@sha256:296486899c825c5106b0de5672c0b14188ae7e45003b2c33b767c6bc32090ee2
    pull_policy: ${pull_policy}
    container_name: ${calibreserver_container_name}
    restart: ${restart}
    networks:
      caddy:
        ipv4_address: 30.30.30.50
    ports:
      - ${calibreserver_port_8181}:8181
    environment:
      - TZ=${timezone}
      - PUID=1000
      - PGID=1000 
    volumes:
      - calibreserver-config:/config
      - media_books:/books